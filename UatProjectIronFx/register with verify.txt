package com.Ironfx.uat.UatProjectIronFx.tests;

import org.testng.annotations.AfterClass;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;
import static org.testng.Assert.assertEquals;

import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

import com.github.javafaker.Faker;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.chrome.ChromeOptions;

import com.Ironfx.uat.UatProjectIronFx.utilities.TestData;
import com.Ironfx.uat.UatProjectIronFx.utilities.ScreenshotUtils;
import com.Ironfx.uat.UatProjectIronFx.utilities.ReportManager;
import com.Ironfx.uat.UatProjectIronFx.pages.RegistrationPage;
import com.Ironfx.uat.UatProjectIronFx.pages.DashboardPage; 
import com.Ironfx.uat.UatProjectIronFx.utilities.WaitUtils;

public class RegistrationPageTest {

    private WebDriver driver;
    private Faker faker;
    private RegistrationPage registrationPage;
    private DashboardPage dashboardPage;

    private static final String password = "Password1!";

    @BeforeClass
    public void setUp() {
        ReportManager.initReport();
        ReportManager.startTest("Registration Page Test");

        System.setProperty("webdriver.chrome.driver", "C://Users/smouzoulas/Desktop/nnnn/chromedriver.exe");

        ChromeOptions options = new ChromeOptions();
        options.addArguments("--incognito");
        driver = new ChromeDriver(options);
        driver.manage().window().maximize();

        driver.get("https://ironfx-com.cp-uat.ironfx.local/en/register");
        registrationPage = new RegistrationPage(driver);
        dashboardPage = new DashboardPage(driver);
        faker = new Faker();

        driver.findElement(By.id("details-button")).click();
        driver.findElement(By.id("proceed-link")).click();

        JavascriptExecutor js = (JavascriptExecutor) driver;
        js.executeScript("document.body.style.zoom='60%'");

        String ssOpen = ScreenshotUtils.takeScreenshot(driver, "Registration_page_Open");
        ReportManager.getTest().info("Opened Registration Page")
                     .addScreenCaptureFromPath(ssOpen);
    }

    @Test
    public void testSuccessfulRegistrationForGCC() {
        String[] countries = {
        		 "Afghanistan","Albania","Algeria","Amer.Virgin Is.","Andorra","Angola","Anguilla","Antarctica",
        		    "Antigua/Barbuda","Argentina","Armenia","Aruba","Australia","Austria","Azerbaijan","Bahamas",
        		    "Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Blue",
        		    "Bolivia","Bosnia-Herz.","Botswana","Bouvet Islands","Brazil","Brit.Ind.Oc.Ter","Brit.Virgin Is.",
        		    "Brunei Daruss.","Bulgaria","Burkina Faso","Burma","Burundi","Cambodia","Cameroon","Canada",
        		    "Cape Verde","CAR","Cayman Islands","Chad","Chile","China","Christmas Island","Coconut Islands",
        		    "Colombia","Comoros","Cook Islands","Costa Rica","Cote d","Croatia","Cuba","Curacao","Cyprus",
        		    "Czech Republic","Dem. Rep. Congo","Denmark","Djibouti","Dominica","Dominican Rep.","Dutch Antilles",
        		    "East Timor","Ecuador","Egypt","El Salvador","Equatorial Guin","Eritrea","Estonia","Ethiopia",
        		    "Falkland Islnds","Faroe Islands","Fiji","Finland","France","Frenc.Polynesia","French Guayana",
        		    "French S.Territ","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland",
        		    "Grenada","Guadeloupe","Guam","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Heard/McDon.Isl",
        		    "Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel",
        		    "Italy","Jamaica","Japan","Jersey","Jordan","Kazakhstan","Kenya","Kiribati","Kosovo","Kuwait",
        		    "Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania",
        		    "Luxembourg","Macau","Macedonia","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta",
        		    "Marshall Islnds","Martinique","Mauretania","Mauritius","Mayotte","Mexico","Micronesia","Minor Outl.Isl.",
        		    "Moldova","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","N.Mariana Islnd",
        		    "Namibia","Nauru","Nepal","Netherlands","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria",
        		    "Niue","Norfolk Islands","North Korea","Norway","Oman","Pakistan","Palau","Palestine","Panama",
        		    "Pap. New Guinea","Paraguay","Peru","Philippines","Pitcairn Islnds","Poland","Portugal","Puerto Rico",
        		    "Qatar","Rep.of Congo","Reunion","Romania","Russian Fed.","Rwanda","S. Sandwich Ins","S.Tome,Principe",
        		    "Saint Helena","Samoa","Samoa, America","San Marino","Saudi Arabia","Senegal","Serbia","Serbia/Monten.",
        		    "Seychelles","Sierra Leone","Singapore","Sint Maarten","Slovakia","Slovenia","Solomon Islands","Somalia",
        		    "South Africa","South Korea","Spain","Sri Lanka","St Kitts&Nevis","St. Lucia","St. Vincent","St.Pier,Miquel.",
        		    "Sudan","Suriname","Svalbard","Swaziland","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania",
        		    "Thailand","Togo","Tokelau Islands","Tonga","Trinidad,Tobago","Tunisia","Turkey","Turkmenistan",
        		    "Turksh Caicosin","Tuvalu","Uganda","Ukraine","United Kingdom","Uruguay","USA","Utd.Arab Emir.","Uzbekistan",
        		    "Vanuatu","Vatican City","Venezuela","Vietnam","Wallis,Futuna","West Sahara","Yemen","Zambia","Zimbabwe"
        };

        for (String country : countries) {
            String Name = faker.regexify("Test" + "[a-zA-Z]{8}");
            String expectedEmail = "nickchigg+" + country.replace(" ", "") + Name + "@gmail.com";
            TestData.generatedEmail = expectedEmail;

            registrationPage.enterFirstName(Name + country);
            registrationPage.enterLastName(Name + country);
            registrationPage.enterEmail(expectedEmail);
            registrationPage.enterCountry(country);   // ‚úÖ ŒßœÅŒ∑œÉŒπŒºŒøœÄŒøŒπŒøœçŒºŒµ œÑŒ∑ŒΩ œÉœâœÉœÑŒÆ ŒºŒ≠Œ∏ŒøŒ¥Œø
            registrationPage.enterPhone("12341234");
            registrationPage.selectAccountType("Standard Floating");
            registrationPage.selectBonusScheme("Not applicable");
            registrationPage.selectCurrency("USD");
            registrationPage.selectLeverage("1:500");
            registrationPage.enterPassword(password);
            registrationPage.enterConfirmPassword(password);

            String ssForm = ScreenshotUtils.takeScreenshot(driver, "Registration_form_" + country);
            ReportManager.getTest().info("Registration form populated for " + country)
                         .addScreenCaptureFromPath(ssForm);

            JavascriptExecutor js = (JavascriptExecutor) driver;
            js.executeScript("window.scrollTo(0, document.body.scrollHeight);");

            registrationPage.clickSubmit();
            ReportManager.logInfo("Clicked Submit for " + country);
            WaitUtils.waitForSeconds(5);
            System.out.println("üîπ Actual Email (" + country + "): " + expectedEmail);
            
           // dashboardPage.clickMyProfileBtn();
          //  dashboardPage.clickVerifyProfileBtn();
          //  js.executeScript("document.body.style.zoom='60%'");

          //  String ssVerify = ScreenshotUtils.takeScreenshot(driver, "Email_Verification_" + country);
          //  ReportManager.getTest().info("Navigated to Email Verification for " + country)
        //                 .addScreenCaptureFromPath(ssVerify);

          //  WaitUtils.waitForSeconds(5);

          //  String actualEmail = driver.findElement(By.id("email")).getAttribute("value");
          //  System.out.println("üîπ Actual Email (" + country + "): " + actualEmail);

       //     try {
       //         assertEquals(actualEmail, expectedEmail,
       //             "The Emails are not the same for " + country + ". Failed Registration.");
         //       ReportManager.getTest().pass("Registration successful for " + country + ". Email verified correctly");
        //    } catch (AssertionError e) {
          //      String ssFail = ScreenshotUtils.takeScreenshot(driver, "Registration_Failed_" + country);
          //      ReportManager.getTest().fail("Registration failed for " + country + ". Expected email: "
          //          + expectedEmail + " but found: " + actualEmail)
           //                  .addScreenCaptureFromPath(ssFail);
          //      throw e;
           // }

            // ŒïœÄŒ±ŒΩŒ±œÜœåœÅœÑœâœÉŒ∑ œÉŒµŒªŒØŒ¥Œ±œÇ Œ≥ŒπŒ± œÑŒ∑ŒΩ ŒµœÄœåŒºŒµŒΩŒ∑ œáœéœÅŒ±
            driver.get("https://ironfx-com.cp-uat.ironfx.local/en/register");
        }
    }

    @AfterClass
    public void tearDown() {
        ReportManager.flushReport();
        if (driver != null) {
            driver.quit();
        }
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyyMMdd_HHmmss");
        String timestamp = LocalDateTime.now().format(formatter);
        String reportPath = "C:\\Users\\smouzoulas\\Desktop\\nnnn\\UatProjectIronFx\\Reports\\TestReport" + timestamp + ".html";

        // EmailReportSender.sendReport("nickchigg@gmail.com", reportPath);
    }
}
